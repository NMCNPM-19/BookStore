<div class="content-page" id="cart-temp" >
    <div class="container-fluid">
        <div id = "title" >
        </div>
        <div class="row">
            <aside class="col-lg-9">
                <div class="card">
                    <div class="table-responsive">
                        <form id="cart-form" {{#if user.emp}}
                                                action="bill/add"
                                            {{else}}action="importOrder/add"
                                            {{/if}} method="POST">
                            <table class="table table-borderless table-shopping-cart">
                                <thead class="text-muted">
                                    <tr class="small text-uppercase">
                                        <th scope="col">Product</th>
                                        <th scope="col" width="120">Quantity</th>
                                        <th scope="col" width="120">Price</th>
                                        <th scope="col" class="text-right d-none d-md-block" width="200"></th>
                                    </tr>
                                </thead>
                                <tbody class="pro">

                                    {{!-- TEST --}}
                                {{#if user.emp}}
                                <input type="hidden" name="MAKH" value="KH0002"> 
                                {{/if}}   
                                </tbody>
                            </table>
                        </form>
                    </div>
                </div>
            </aside>
            <aside class="col-lg-3">
                <div class="card mb-3">
                    <div class="card-body">
                        <form>
                            {{#if user.emp}}
                            <div class="form-group"> <label>Thông tin mua hàng</label>
                                <div class="input-group"> <input type="text" class="form-control coupon" name=""
                                        placeholder="Coupon code"> <span class="input-group-append"> <button
                                            class="btn btn-primary btn-apply coupon">Apply</button> </span> </div>
                            </div>
                            {{else}}
                              <div class="form-group"> <label>Thông tin nhập hàng</label>
                                <div class="input-group"> <input type="text" class="form-control coupon" name=""
                                        placeholder="Coupon code"> <span class="input-group-append"> <button
                                            class="btn btn-primary btn-apply coupon">Apply</button> </span> </div>
                             </div>
                            {{/if}}

                        </form>
                    </div>
                </div>
                <div class="card">

                    <div class="card-body">
                        {{#if user.emp}}
                        <dl class="dlist-align">
                            <dt>Total price:</dt>
                            <dd class="text-right ml-3"><p id="tong"></p></dd>
                        </dl>
                        <dl class="dlist-align">
                            <dt>Total:</dt>
                            <dd class="text-right text-dark b ml-3"><strong><p id="tong"></p></strong></dd>
                        </dl>
                        <hr>
                        <a href="#" class="btn btn-out mt-2 btn-primary btn-square btn-main" data-abc="true"> Debt</a>
                        {{/if}}
                         <button form="cart-form" type="submit" class="btn btn-out mt-2 btn-primary btn-square btn-main" data-abc="true">Confirm</button>
                         
                         <a href="#" class="btn btn-out mt-2 btn-primary btn-square btn-main" data-abc="true">invoice printing</a>
                        <a href="/" class="btn btn-out mt-2 btn-success btn-square btn-main mt-2" data-abc="true">Add Book</a>
                    </div>

                </div>
            </aside>
        </div>
         </div>
    
</div>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>


</head>
<script type="text/javascript">
    var quantity 
    var min = '{{min}}'
    var LOAINV = '{{user.emp}}'
    //$.getJSON()
 

    var result = $('#cart-temp')

    function loadfunctions() {
        $.getJSON('/cart/resfesh', function( data ) {
        $('div#title').append("<h3> "+ data.title +" </h3>")
        if(data.products){
            for( const i of data.products){
              $('tbody.pro').append(`<tr>
                                        <td>
                                            <figure class="itemside align-items-center">
                                                <div class="aside"><img src="${i.item.IMAGE}" class="img-sm"></div>
                                                <figcaption class="info"> <a href="#" class="title text-dark"
                                                        data-abc="true">${i.item.tensach}</a>
                                                    <p class="text-muted small">${i.item.tacgia} <br> ${i.item.ngayXB}</p>
                                                </figcaption>
                                            </figure>
                                        </td>
                                        <td>
                                            <input type="hidden" name="masach" value="${i.item.masach}">
                                            <input class="form-control text-center input-quantity" data-masach="${i.item.masach}" name="SL" min="${min}"  step="1" type="number" value=${i.quantity} >
                                        </td>
                                        <td>
                                            <div class="price-wrap"> <var class="price">${i.price} vnd </var> </div>
                                        </td>
                                        <td class="text-right d-none d-md-block">
                                            <a href="/cart/remove/${i.item.masach}" class="btn btn-light" data-abc="true"> Remove </a>
                                        </td>
                                    </tr>`)
            }
        }else{
            $('tbody.pro').append(`<tr> <td rowspan="4"> <p class = "text-center">Nothing here</p> </td> </tr>`)
        }
        $('p#tong').append(`${data.totalPrice}`)
    })
     quantity = $('input.input-quantity')
     console.log(quantity)
    }
    $(document).ready(function(){ 
        $('body').on('change','input.input-quantity',function(e){
            e.preventDefault()
        
        let quantity = $(this).val()
        let id = $(this).data('masach')
        $.ajax({
            url: '/cart/update-quantity',
            method: 'GET',
            data: { 
                quantity : quantity,
                id: id,
            },
            success: function(data){
                $('div#title').empty()
                $('tbody.pro').empty()
                $('p#tong').empty()
                loadfunctions()
            }
        })
        }); 
        });
    loadfunctions()
   
    
</script>









